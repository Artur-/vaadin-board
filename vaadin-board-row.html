<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">

<dom-module id="vaadin-board-row">
  <template>
    <style>
      :host {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        align-items: stretch;
      }

      :host ::slotted(*) {
        box-sizing: border-box;
        flex-grow: 1;
      }
    </style>
    <slot id="insertionPoint"></slot>
  </template>

  <script>
    Polymer({
      is: 'vaadin-board-row',
      behaviors: [
        Polymer.IronResizableBehavior
      ],
      listeners: {
        'iron-resize': '_onIronResize'
      },

      properties: {
        oldWidth: {
          type: Number,
          value: 0
        },
        oldFlexBasis: {
          type: String,
          value: '0'
        }
      },
      attached: function() {
        this.async(this._onIronResize,1);
      },
      _onIronResize: function () {
        const width = this.offsetWidth;
        if (width != this.oldWidth) {
          const nodes = this.$.insertionPoint.assignedNodes();
          const filteredNodes = nodes.filter(node => node.nodeType !== node.TEXT_NODE);
          var newFlexBasis = '25%';
          if (width < 600) {
            newFlexBasis = '100%';
          } else if (width < 1000) {
            newFlexBasis = '50%';
          }
          if(newFlexBasis!=this.oldFlexBasis){
            filteredNodes.forEach(e =>e.style.flexBasis = newFlexBasis);
            this.oldFlexBasis = newFlexBasis;
          }
          this.oldWidth = width;
        }
      }
    });
  </script>
</dom-module>
